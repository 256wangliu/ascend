---
title: "Exploring scRNASeq data with ASCEND"
author: "Anne Senabouth"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Exploring scRNASeq data with ASCEND}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Exploring the Retinal Ganglion Cell (RGC) dataset
The following example uses data prepared from the vignette [An introduction to ASCEND - Processing and analysis of retinal ganglion cells](RGC_Tutorial.Rmd). This data has undergone cell cycle assignment, filtering, normalisation, dimension reduction and clustering. 

```{r LoadExample}
data(rgc.obj)
rgc.obj
```

Let's retrieve the expression matrix as a dataframe, and have a look at it.
```{r ExampleGetMatrix}
expression.matrix <- GetExpressionMatrix(rgc.obj, "data.frame")
expression.matrix[1:10, 1:10]
```

These counts have been normalised using the `scranNormalise` function. We can review the log to see what other methods were used on this object.
```{r ReviewLog}
DisplayLog(rgc.obj)
```

Because the object has been normalised with the `scranNormalise` function, the controls - mitochondrial and ribosomal transcripts, have been removed from the dataset.

This dataset has undergone cell cycle and cluster assignment. We can view this information in the cell information slot.

```{r ExamineCellInfo}
cell.info <- GetCellInfo(rgc.obj)
cell.info[1:10,]
```


We can characterise these cells further by identifying cells that express certain transcripts; in this case, we are interested in transcripts belonging to the BRN-3 family (The Brn-3 family of POU-domain factors: primary structure, binding specificity, and expression in subsets of retinal ganglion cells and somatosensory neurons)[http://www.jneurosci.org/content/15/7/4762].

As we have extracted the expression matrix as a dataframe, we can use general R functions to identify which cells express transcripts from this family.

```{r IdentifyCells}
# Transcripts from BRN-3 family - 
brn3.transcripts <- c("POU4F1", "POU4F2", "POU4F3")

# Extract rows from matrix belonging to these transcripts
brn3.transcript.counts <- expression.matrix[brn3.transcripts, ]

# Identify cells (columns) where transcript counts are greater than one
brn3.cells <- names(which(colSums(brn3.transcript.counts) > 0))
brn3.cells
```

There are 21 cells expressing transcripts from this family. 

Add this information to the Cell Information dataframe and update the object.

```{r UpdateCellInfo}
# Make a copy of the original cell information
updated.cell.info <- cell.info

# Create a new column for BRN3 expression, where default expression is false
updated.cell.info$BRN3 <- rep(FALSE, nrow(updated.cell.info))

# Label cells that do express BRN3 transcripts as TRUE
updated.cell.info$BRN3[which(updated.cell.info$cell_barcode %in% brn3.cells)] <- TRUE

# Replace the information
brn3.obj <- ReplaceCellInfo(rgc.obj, updated.cell.info)
```

Let's see how these cells are positioned on PCA, TSNE and MDS plots. We'll colour BRN3-expressing cells red (#990000) and non-expressing cells a dark grey (#333333).

#### PCA Plot
```{r PCA_BRN3}
# Load ggplot2 so we can modify the plot
library(ggplot2)

# PCA Plot
pca.plot <- PlotPCA(brn3.obj, dim1 = 1, dim2 = 2, condition = "BRN3")
pca.plot <- pca.plot + scale_color_manual(values=c("#333333", "#990000"))
print(pca.plot)
```

#### MDS Plot
```{r MDS_BRN3}
# Plot MDS
mds.plot <- PlotMDS(brn3.obj, PCA = TRUE, dim1 = 1, dim2 = 2, condition = "BRN3")
mds.plot <- mds.plot + scale_color_manual(values=c("#333333", "#990000"))
print(mds.plot)
```

#### TSNE Plot
```{r TSNE_BRN3}
tsne.plot <- PlotTSNE(brn3.obj, PCA = TRUE, condition = "BRN3", seed = 1, perplexity = 30, theta = 0.5)
tsne.plot <- tsne.plot + scale_color_manual(values=c("#333333", "#990000"))
print(tsne.plot)
```

